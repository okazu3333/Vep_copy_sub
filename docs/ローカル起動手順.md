# ローカル起動手順（ダミーデータモード）

## クイックスタート

### 1. 環境変数の設定

`.env.local` ファイルを作成（または既存のものを確認）:

```bash
NEXT_PUBLIC_USE_DUMMY_ALERTS=1
PORT=3002
```

### 2. 依存関係のインストール

```bash
npm install
# または
pnpm install
```

### 3. 開発サーバーの起動

```bash
# 方法1: npmスクリプト
npm run dev

# 方法2: 専用スクリプト
./scripts/start_local.sh

# 方法3: 手動起動
NEXT_PUBLIC_USE_DUMMY_ALERTS=1 npm run dev
```

### 4. ブラウザで確認

- メイン画面: http://localhost:3002
- アラート一覧: http://localhost:3002/alerts
- ダッシュボード: http://localhost:3002/dashboard

## 確認したいエンドポイント

### 検知ルールAPI
```bash
# 全ルール
curl "http://localhost:3002/api/detection-rules?limit=10"

# 特定ルール
curl "http://localhost:3002/api/detection-rules?rule_type=inactivity_72h&limit=5"
curl "http://localhost:3002/api/detection-rules?rule_type=sentiment_urgency&limit=5"
curl "http://localhost:3002/api/detection-rules?rule_type=tone_frequency_drop&limit=5"
```

### 統合アラート検知API
```bash
# 全アラート
curl "http://localhost:3002/api/alerts-detection?limit=10"

# 重要度フィルタ
curl "http://localhost:3002/api/alerts-detection?severity=A&limit=5"

# セグメントフィルタ
curl "http://localhost:3002/api/alerts-detection?segment=inactivity_risk&limit=5"
```

### 既存アラートAPI（拡張版）
```bash
# アラート一覧（新しい指標を含む）
curl "http://localhost:3002/api/alerts?limit=10"

# 検索付き
curl "http://localhost:3002/api/alerts?search=不具合&limit=5"
```

## ダミーデータの内容

### 検知ルールのダミーデータ

1. **72時間放置検知**
   - thread_id: `thread-002`
   - 放置時間: 96時間（4日）
   - スコア: 70
   - 重要度: B

2. **感情ダウン + 催促検知**
   - thread_id: `thread-002`
   - 感情スコア: -0.55
   - 催促ワード数: 2
   - スコア: 85
   - 重要度: A

3. **トーンダウン + 頻度低下検知**
   - thread_id: `thread-001`
   - 感情下降: -0.25
   - 頻度比: 0.4
   - スコア: 65
   - 重要度: B

### フェーズCのダミーデータ

- thread_id: `thread-002`
- 鎮火確率（24h）: 25%
- 予測解決時間: 1440分（24時間）
- ハザードスコア: 0.8

### フェーズDのダミーデータ

- thread_id: `thread-002`
- 品質スコア: 45点
- 品質レベル: Low

## 動作確認チェックリスト

- [ ] サーバーが正常に起動する
- [ ] `/alerts` ページでアラート一覧が表示される
- [ ] `/api/detection-rules` で検知ルール結果が返る
- [ ] `/api/alerts-detection` で統合アラートが返る
- [ ] `/api/alerts` で新しい指標（phaseC, phaseD, detectionRule）が含まれる
- [ ] アラート詳細画面で新しい指標が表示される
- [ ] 検知理由に新しいルールの結果が表示される

## トラブルシューティング

### サーバーが起動しない
```bash
# ポートが使用中の場合
lsof -ti:3002 | xargs kill -9

# 再起動
npm run dev
```

### ダミーデータが表示されない
- `.env.local` に `NEXT_PUBLIC_USE_DUMMY_ALERTS=1` が設定されているか確認
- ブラウザのキャッシュをクリア
- 開発サーバーを再起動

### APIがエラーを返す
- ブラウザの開発者ツール（F12）でエラーを確認
- サーバー側のコンソールログを確認
- ネットワークタブでリクエスト/レスポンスを確認

## 次のステップ

1. ダミーデータで動作確認
2. BigQueryのダミーデータセットに接続
3. 実際のデータで検証
4. 本番環境へのデプロイ

