# 動作確認チェックリスト

## ローカルホスト起動確認

### 1. サーバー起動
```bash
# 開発サーバーを起動（ポート3002）
npm run dev

# または専用スクリプト
./scripts/start_local.sh
```

**確認ポイント:**
- [ ] サーバーが正常に起動する
- [ ] ポート3002でアクセス可能
- [ ] エラーが発生していない

### 2. ブラウザでの確認

#### メインページ
- URL: http://localhost:3002
- [ ] ページが表示される
- [ ] ダッシュボードにリダイレクトされる

#### アラート一覧ページ
- URL: http://localhost:3002/alerts
- [ ] アラート一覧が表示される
- [ ] ダミーデータのアラートが2件表示される
- [ ] 新しい指標（phaseC, phaseD, detectionRule）が含まれている

#### アラート詳細
- [ ] アラートをクリックすると詳細モーダルが開く
- [ ] フェーズCの指標（鎮火確率、予測解決時間）が表示される
- [ ] フェーズDの指標（返信品質スコア）が表示される
- [ ] 検知ルールの結果が表示される
- [ ] 検知理由に新しいルールの結果が含まれる

## API動作確認

### 1. 検知ルールAPI

#### 全ルール取得
```bash
curl "http://localhost:3002/api/detection-rules?limit=10"
```

**期待される結果:**
- `success: true`
- `dummy_mode: true`
- `results` 配列に3件の検知結果が含まれる
  - `inactivity_72h` (72時間放置検知)
  - `sentiment_urgency` (感情ダウン + 催促検知)
  - `tone_frequency_drop` (トーンダウン + 頻度低下検知)

#### 特定ルール取得
```bash
# 72時間放置検知のみ
curl "http://localhost:3002/api/detection-rules?rule_type=inactivity_72h&limit=5"

# 感情ダウン + 催促検知のみ
curl "http://localhost:3002/api/detection-rules?rule_type=sentiment_urgency&limit=5"
```

**確認ポイント:**
- [ ] 各ルールタイプで適切な結果が返る
- [ ] スコア、重要度、詳細情報が正しく含まれる

### 2. 統合アラート検知API

#### 全アラート取得
```bash
curl "http://localhost:3002/api/alerts-detection?limit=10"
```

**期待される結果:**
- `success: true`
- `dummy_mode: true`
- `alerts` 配列に4件のアラートが含まれる
  - 検知ルールアラート（72h放置、感情+催促）
  - フェーズCアラート（鎮火確率低）
  - フェーズDアラート（返信品質低）

#### フィルタリング
```bash
# 重要度Aのみ
curl "http://localhost:3002/api/alerts-detection?severity=A&limit=5"

# セグメントフィルタ
curl "http://localhost:3002/api/alerts-detection?segment=inactivity_risk&limit=5"
```

**確認ポイント:**
- [ ] フィルタが正しく機能する
- [ ] 各アラートに適切な情報が含まれる

### 3. 既存アラートAPI（拡張版）

#### アラート一覧取得
```bash
curl "http://localhost:3002/api/alerts?limit=10"
```

**期待される結果:**
- `success: true`
- `alerts` 配列にアラートが含まれる
- 各アラートに以下の新しい指標が含まれる:
  - `phaseC`: 鎮火確率、予測解決時間
  - `phaseD`: 返信品質スコア、品質レベル
  - `detectionRule`: 検知ルールタイプ、放置時間、スコア
  - `detectionReasons`: 新しい検知理由が追加されている

**確認ポイント:**
- [ ] 新しい指標が正しく含まれる
- [ ] 検知理由に新しいルールの結果が追加されている
- [ ] 統合スコアが正しく計算されている

## 画面表示確認

### アラート一覧画面

**確認項目:**
- [ ] アラートカードに新しい指標が表示される
- [ ] 検知理由に新しいルールの結果が表示される
- [ ] 重要度バッジが正しく表示される
- [ ] セグメントバッジが正しく表示される

### アラート詳細画面

**確認項目:**
- [ ] フェーズCの指標が表示される
  - 鎮火確率（24時間以内）
  - 予測解決時間
- [ ] フェーズDの指標が表示される
  - 返信品質スコア
  - 品質レベル
- [ ] 検知ルールの結果が表示される
  - ルールタイプ
  - 放置時間（該当する場合）
  - 検知スコア
- [ ] 検知理由セクションに新しいルールの結果が含まれる

## 検知ルール別確認

### 1. 72時間放置検知

**確認項目:**
- [ ] アラートID: `DR-dummy-001-72h`
- [ ] 放置時間: 96時間（4日）
- [ ] スコア: 70
- [ ] 重要度: B
- [ ] 検知理由: "4日間放置"

### 2. 感情ダウン + 催促検知

**確認項目:**
- [ ] アラートID: `DR-dummy-002-urg`
- [ ] 感情スコア: -0.55
- [ ] 催促ワード数: 2
- [ ] スコア: 85
- [ ] 重要度: A
- [ ] 検知理由: "不安傾向にあるので、不安解消フォロー"

### 3. トーンダウン + 頻度低下検知

**確認項目:**
- [ ] 感情下降: -0.25
- [ ] 頻度比: 0.4
- [ ] スコア: 65
- [ ] 重要度: B

### 4. フェーズC（鎮火確率予測）

**確認項目:**
- [ ] アラートID: `PC-dummy-001`
- [ ] 鎮火確率: 25%（24時間以内）
- [ ] 予測解決時間: 24時間
- [ ] ハザードスコア: 0.8
- [ ] 検知理由: "鎮火確率が低い (25%)"

### 5. フェーズD（返信品質スコア）

**確認項目:**
- [ ] アラートID: `PD-dummy-001`
- [ ] 品質スコア: 45点
- [ ] 品質レベル: Low
- [ ] 検知理由: "返信品質が低い (45点)"

## トラブルシューティング

### サーバーが起動しない
```bash
# ポートが使用中の場合
lsof -ti:3002 | xargs kill -9

# 再起動
npm run dev
```

### ダミーデータが表示されない
1. `.env.local` ファイルを確認
   ```bash
   cat .env.local
   # NEXT_PUBLIC_USE_DUMMY_ALERTS=1 が設定されているか確認
   ```

2. ブラウザのキャッシュをクリア
3. 開発サーバーを再起動

### APIがエラーを返す
1. ブラウザの開発者ツール（F12）でエラーを確認
2. サーバー側のコンソールログを確認
3. ネットワークタブでリクエスト/レスポンスを確認

## 完了チェックリスト

- [ ] サーバーが正常に起動する
- [ ] アラート一覧ページが表示される
- [ ] アラート詳細モーダルが開く
- [ ] 新しい指標（phaseC, phaseD, detectionRule）が表示される
- [ ] 検知ルールAPIが正常に動作する
- [ ] 統合アラート検知APIが正常に動作する
- [ ] 既存アラートAPIに新しい指標が含まれる
- [ ] すべての検知ルールが正しく表示される

## 次のステップ

1. ダミーデータで動作確認完了
2. BigQueryのダミーデータセットに接続
3. 実際のデータで検証
4. 本番環境へのデプロイ

