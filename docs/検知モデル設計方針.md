# 検知モデル設計方針

## 結論

**全セグメント分の検知モデルは必要ありません。**

## セグメントの分類と検知モデルの必要性

### 検知モデルが必要なセグメント（9/10）

#### 予兆セグメント（4件）- すべて検知モデルが必要
- `forecast_tone_down` - トーンダウン ✅ 実装済み（tone_frequency_drop）
- `forecast_trust_risk` - 不安・不信感 ❌ 未実装
- `forecast_inactive` - 放置予兆 ✅ 実装済み（inactivity_72h）
- `forecast_response_quality` - 対応時間/品質 ❌ 未実装（night_reply_anomalyを活用可能）

#### 発生セグメント（5件）- すべて検知モデルが必要
- `occurrence_followup` - 催促・遅延 ✅ 実装済み（sentiment_urgency）
- `occurrence_complaint` - 不満 ❌ 未実装
- `occurrence_silence` - 沈黙 ❌ 未実装
- `occurrence_proposal_issue` - 提案差異・情報共有不足 ❌ 未実装
- `occurrence_reoccurrence` - 再発 ❌ 未実装

### 検知モデルが不要なセグメント（1/10）

#### フォローセグメント（1件）- セグメント遷移で自動設定
- `follow_recovery` - 回復確認
  - **理由**: セグメント遷移（発生→回復）によって自動的に設定される
  - **設定タイミング**: 
    - 催促発生後に返信した場合
    - ステータスが`in_progress`または`completed`で24時間以上経過
    - Phase Cデータ（鎮火確率）が存在
    - 感情スコア > 0（ポジティブ反応）

## 設計方針

### 1. 検知モデルの役割
- **目的**: 「問題の検知」に特化
- **対象**: 予兆・発生セグメント（9件）
- **実装**: メール内容、時間経過、感情スコアなどを分析して問題を検知

### 2. セグメント遷移の役割
- **目的**: 「問題の進展」を管理
- **対象**: フォローセグメント（1件）
- **実装**: 検知された問題への対応状況を監視し、回復段階に遷移

### 3. 検知モデルとセグメントの関係

```
検知モデル → セグメント（予兆・発生）
    ↓
セグメント遷移 → セグメント（フォロー）
```

## 実装優先順位

### Phase 1: 高優先度（発生セグメント）
1. `occurrence_proposal_issue_detection` - 提案差異・情報共有不足
2. `occurrence_complaint_detection` - 不満
3. `occurrence_silence_detection` - 沈黙

### Phase 2: 中優先度（予兆セグメント）
4. `forecast_trust_risk_detection` - 信頼リスク
5. `forecast_response_quality_detection` - 対応品質（既存ルール活用）

### Phase 3: 低優先度
6. `occurrence_reoccurrence_detection` - 再発（過去のアラート履歴との照合が必要）

## まとめ

- **検知モデルが必要**: 9セグメント（予兆4 + 発生5）
- **検知モデルが不要**: 1セグメント（フォロー1）
- **実装済み**: 3セグメント
- **未実装**: 6セグメント

**結論**: 全セグメント分の検知モデルは必要ありません。`follow_recovery`はセグメント遷移によって自動設定されるため、検知モデルは不要です。

