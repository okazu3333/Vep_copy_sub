# ユースケース入力機能の配置と設計

## 📋 現状分析

### 既存のユースケース関連機能
1. **`/keywords`** - キーワード管理
   - セグメント設定（アコーディオン形式）
   - キーワードリクエスト（ユースケース入力 → テンプレート生成）

2. **`/keywords/segments`** - フレーズ設定（AI支援）
   - AIキーワード生成（ユースケース入力 → 推奨セグメント/キーワード）
   - セグメント・シナリオ一覧/詳細、編集

### 問題点
- ユースケース入力が2箇所に分散している
- サイドバーのマスタ管理に「キーワード管理」が含まれていない
- 入力フローが複雑で、ストレスなく入力するには改善が必要

---

## 🎯 推奨配置案

### 案1: マスタ管理に統合（推奨）

**配置場所**: サイドバーの「マスタ管理」配下に追加

```
マスタ管理
├─ ユーザー管理 (/users)
├─ 顧客情報管理 (/customers)
├─ 通知管理 (/notifications)
└─ 検知ルール管理 (/rules) ← 新規追加
    ├─ ユースケース入力（メイン機能）
    ├─ セグメント設定
    ├─ キーワード/フレーズ管理
    └─ 検知ルール一覧
```

**メリット**:
- 既存のマスタ管理と統一感がある
- 管理者が一箇所で全ての設定を管理できる
- サイドバーの構造が明確になる

**実装内容**:
- `/app/rules/page.tsx` を新規作成
- タブ形式で機能を整理：
  - **タブ1: ユースケース入力**（メイン機能）
  - **タブ2: セグメント設定**
  - **タブ3: キーワード管理**
  - **タブ4: 検知ルール一覧**

---

### 案2: 既存の `/keywords/segments` を拡張

**配置場所**: 既存の `/keywords/segments` を改善

**改善内容**:
1. **ユースケース入力の簡素化**
   - ワンステップ入力フォーム
   - AI支援による自動補完
   - リアルタイムプレビュー

2. **フロー改善**
   - 入力 → AI分析 → 確認 → 適用（3ステップ）
   - 履歴管理の強化

**メリット**:
- 既存機能を活用できる
- 実装コストが低い

**デメリット**:
- マスタ管理との統一感が薄い
- サイドバーに表示されていない

---

### 案3: 独立した「検知ルール管理」ページ

**配置場所**: サイドバーのトップレベルに追加

```
ダッシュボード
アラート一覧
検知ルール管理 (/rules) ← 新規追加
マスタ管理
  ├─ ユーザー管理
  ├─ 顧客情報管理
  └─ 通知管理
```

**メリット**:
- 検知ルール管理の重要性を強調
- アクセスしやすい

**デメリット**:
- サイドバーが複雑になる可能性

---

## 💡 推奨実装: 案1（マスタ管理に統合）

### 実装ステップ

#### Step 1: サイドバーに「検知ルール管理」を追加

```typescript
// components/sidebar.tsx
const masterMenuItems = [
  { href: "/users", label: "ユーザー管理", icon: Users },
  { href: "/customers", label: "顧客情報管理", icon: Database },
  { href: "/notifications", label: "通知管理", icon: Bell },
  { href: "/rules", label: "検知ルール管理", icon: Settings }, // 新規追加
]
```

#### Step 2: `/app/rules/page.tsx` を作成

**主要機能**:
1. **ユースケース入力タブ**
   - シンプルなテキストエリア
   - AI分析ボタン
   - 推奨結果の表示と確認
   - ワンクリック適用

2. **セグメント設定タブ**
   - 既存のセグメント一覧
   - セグメント追加/編集
   - 検知条件の設定

3. **キーワード管理タブ**
   - キーワード/フレーズ一覧
   - 追加/編集/削除
   - セグメントとの紐付け

4. **検知ルール一覧タブ**
   - 全ルールの一覧表示
   - 有効/無効の切り替え
   - ルールの優先順位設定

#### Step 3: ユースケース入力のUI改善

**改善ポイント**:
- **入力フォームの簡素化**
  ```tsx
  <Textarea
    placeholder="例: 顧客から解約の意思表示があった場合にアラートを出したい"
    className="min-h-[120px]"
  />
  ```

- **AI分析の自動実行**
  - 入力後3秒待機して自動分析
  - または「分析」ボタンで手動実行

- **推奨結果の視覚化**
  - セグメント候補をカード形式で表示
  - 信頼度スコアの表示
  - キーワードのハイライト

- **ワンクリック適用**
  - 「この設定を適用」ボタン
  - 確認ダイアログで最終確認

#### Step 4: APIエンドポイントの作成

```typescript
// app/api/rules/use-case/route.ts
// ユースケース分析API
POST /api/rules/use-case
{
  "useCase": "顧客から解約の意思表示があった場合にアラートを出したい"
}

Response:
{
  "recommendations": [
    {
      "segment": "occurrence_complaint",
      "keywords": ["解約", "キャンセル", "終了"],
      "confidence": 0.95,
      "reasoning": "..."
    }
  ]
}
```

---

## 🎨 UI/UX改善案

### ユースケース入力の理想的なフロー

```
┌─────────────────────────────────────┐
│  1. ユースケース入力                   │
│  ┌─────────────────────────────────┐ │
│  │ 顧客から解約の意思表示があった   │ │
│  │ 場合にアラートを出したい         │ │
│  └─────────────────────────────────┘ │
│         [AI分析] ボタン              │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│  2. AI分析結果（自動表示）          │
│  ┌─────────────────────────────────┐ │
│  │ 推奨セグメント: 解約リスク       │ │
│  │ 信頼度: 95%                      │ │
│  │                                  │ │
│  │ 推奨キーワード:                  │ │
│  │ • 解約                           │ │
│  │ • キャンセル                     │ │
│  │ • 終了                           │ │
│  └─────────────────────────────────┘ │
│  [この設定を適用] [編集] [破棄]      │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│  3. 確認ダイアログ                   │
│  「この検知ルールを適用しますか？」  │
│  [適用] [キャンセル]                 │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│  4. 適用完了                         │
│  ✅ 検知ルールが追加されました        │
└─────────────────────────────────────┘
```

### 入力支援機能

1. **テンプレート機能**
   - よく使うユースケースのテンプレート
   - 「解約リスク」「クレーム対応」「競合脅威」など

2. **履歴機能**
   - 過去に入力したユースケースの履歴
   - 再利用可能

3. **プレビュー機能**
   - 設定前のプレビュー表示
   - 実際のアラート例の表示

---

## 📊 データ構造

### ユースケースデータ

```typescript
interface UseCase {
  id: string
  description: string // ユーザーが入力したテキスト
  segment: SegmentKey
  keywords: string[]
  priority: 'high' | 'medium' | 'low'
  detectionRule: {
    type: string
    threshold?: number
    conditions?: Record<string, any>
  }
  status: 'draft' | 'active' | 'inactive'
  createdAt: Date
  updatedAt: Date
  createdBy: string
}
```

---

## 🚀 実装優先順位

### Phase 1: 基本機能（最優先）
1. ✅ サイドバーに「検知ルール管理」を追加
2. ✅ `/app/rules/page.tsx` を作成
3. ✅ ユースケース入力タブの実装
4. ✅ AI分析APIの実装（モックでも可）

### Phase 2: UI/UX改善
1. テンプレート機能
2. 履歴機能
3. プレビュー機能

### Phase 3: 高度な機能
1. ルールの優先順位管理
2. A/Bテスト機能
3. ルールの効果測定

---

## 📝 まとめ

**推奨配置**: マスタ管理配下に「検知ルール管理」を追加

**主な改善点**:
1. ユースケース入力の簡素化（ワンステップ）
2. AI分析の自動化/簡素化
3. 視覚的な推奨結果表示
4. ワンクリック適用

**期待される効果**:
- 入力ストレスの軽減
- 設定時間の短縮
- 管理者の作業効率向上

